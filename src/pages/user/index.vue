<template>
  <div class="page__bd">
      <div class="weui-cells">
           <button class="weui-btn weui-btn_midum weui-btn_primary" @click="upload">+</button>
     </div>
  </div>
</template>

<script>
import qiniuUploader from "@/utils/qiniuload.js";
export default {
  data() {
    return {};
  },
  mounted() {},
  methods: {
    upload() {
      const _this = this;
      wx.request({
        url: "", // 请求获取token用户，验证此用户是否合法
        data: {
          sessionKey: "",
          flag: "" // 图片和简介的共同标识
        },
        header: {
          "content-type": "application/json" // 默认值
        },
        success: function(response) {
          wx.chooseImage({
            success: function(resp) {
              const tempFilePaths = resp.tempFilePaths;
              qiniuUploader.upload(
                tempFilePaths,
                res => {
                  _this.setData({
                    imageURL: res.imageURL
                  });
                },
                error => {
                  console.log("error: " + error);
                },
                {
                  region: "SCN",
                  domain: response.domain,
                  uptoken: response.token,
                  sessionKey: "",
                  flag: "" // 图片和简介的共同标识
                },
                res => {
                  console.log("上传进度", res.progress);
                  console.log("已经上传的数据长度", res.totalBytesSent);
                  console.log(
                    "预期需要上传的数据总长度",
                    res.totalBytesExpectedToSend
                  );
                }
              );
            }
          });
        }
      });
    }
  }
};
</script>

<style>
</style>
